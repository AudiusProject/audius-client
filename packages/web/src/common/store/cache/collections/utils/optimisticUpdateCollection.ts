import { Collection, Kind, cacheActions } from '@audius/common'
import { put } from 'typed-redux-saga'

export function* optimisticUpdateCollection(collection: Collection) {
  if (collection.artwork?.url) {
    const { artwork } = collection
    const { url } = artwork
    collection.artwork = artwork
    collection.cover_art_sizes = url!
    const coverArtSizes = collection._cover_art_sizes ?? {}
    coverArtSizes.OVERRIDE = url
    collection._cover_art_sizes = coverArtSizes
    collection.is_image_autogenerated = true
  }

  yield* put(
    cacheActions.update(Kind.COLLECTIONS, [
      { id: collection.playlist_id, metadata: collection }
    ])
  )
}
